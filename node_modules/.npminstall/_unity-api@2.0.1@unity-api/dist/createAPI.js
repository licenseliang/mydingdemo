'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _callAPIMethod = require('./callAPIMethod');

var _callAPIMethod2 = _interopRequireDefault(_callAPIMethod);

var _applyMiddleware = require('./applyMiddleware');

var _applyMiddleware2 = _interopRequireDefault(_applyMiddleware);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var createAPI = function createAPI() {
    var resources = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var middleware = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
    var APINamespace = arguments[2];
    var fetchOptions = arguments[3];
    return Object.keys(resources).reduce(function (api, resourceId) {
        api[resourceId] = Object.keys(resources[resourceId].methods).reduce(function (resource, method) {
            resource[method] = function (params, methodOptions) {
                var apiParams = resources[resourceId].methods[method](params);
                var boundCallAPIMethod = _callAPIMethod2.default.bind(null, APINamespace, fetchOptions, resources[resourceId].namespace || resources[resourceId].prefix);
                return (0, _applyMiddleware2.default)(boundCallAPIMethod, middleware, methodOptions, apiParams, resourceId, method);
            };
            return resource;
        }, {});
        return api;
    }, {});
};

exports.default = createAPI;